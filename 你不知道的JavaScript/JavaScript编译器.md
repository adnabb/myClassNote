# JavaScript执行介绍

## 编译器理论

传统的编译器一般包括下面的三种基础步骤：

（1）分词、词法分析；

（2）解析；

（3）代码生成。

我们以 `var a = 2;`来举例，

（1）首先，编译器将这一句代码分为几个块儿，可能是`var`、 `a`、 `=` 、 `2`和`;`；具体是否将一个词（比如var、空格等）进行切割，是通过词法分析来判断的；

（2）然后编译器需要将代码解析为一棵抽象语法树；
```
  var
  |-----------|
  a           =
              |
              2
```

（3）最后编译器将抽象语法树翻译为计算机可以读懂的代码，引擎运行该代码执行程序。

这三个步骤是最基础的，在编译时还会存在优化执行效率等步骤的存在。JavaScript相对于其他语言的编译器更特殊的是，他不存在预编译的过程，JavaScript代码在运行时，先通过几微妙或者更少的时间进行编译，随后代码就立马执行了。

同样是这段代码`var a = 2;`，

## JavaScript的编译器、引擎和作用域之间的关系

想深入了解JavaScript，我们就需要了解JavaScript里面的三个机制 —— 引擎、编译器和作用域；他们三个协同工作从而能使我们的代码正常的运行。首先我们简单了解一下他们的分工：

（1）引擎：负责从始至终的编译和执行我们的JavaScript程序；

（2）编译器：负责解析和生成可执行的JavaScript代码；

（3）作用域：负责管理所有已声明的标识符列表，对当前代码如何访问变量约束了严格的规则。

关于引擎在执行编译器在第二步产生的可执行代码时，还有一个很重要的知识点 —— LHS（left-hand-side） 和 RHS（right-hand-side） 查询；简单来说，LHS是对变量赋值的查询、RHS是获取变量值的查询。

我们以下面的代码举例：

```js
function foo(a) {
	var b = a;
	return a + b;
}

var c = foo( 2 );
```

下面是引擎、编译器和作用域工作的详细步骤：

（1）`var c = ...`是对c的赋值操作，属于LHS引用（1L）；赋值的右边是`foo(...)`，需要RHS引用，找到foo（1R）；
（2）在`foo(2)`执行时，有一个隐含的LHS引用，将2赋值给a（2L）；
（3）`var b = ...`属于LHS引用（3L）；对于赋值操作右边的`a`，需要获取a的值，用的是RHS引用（2R）；
（4）`return a + b`这里需要查询a（3R）和b（4R）的值，用了两次RHS查询；

## 总结